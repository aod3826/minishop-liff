<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Shop - ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</title>
    
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --bg-color: #f8f9fa;
            --text-color: #333333;
            --light-gray: #f1f5f9;
            --card-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            --header-shadow: 0 10px 30px rgba(118, 75, 162, 0.2);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Prompt', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            padding-bottom: 120px;
            line-height: 1.6;
        }

        /* Header Section */
        .header-cover {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            padding: 40px 20px 30px;
            border-radius: 0 0 35px 35px;
            color: white;
            box-shadow: var(--header-shadow);
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
        }

        .header-cover::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 100" preserveAspectRatio="none"><path d="M0,0 L1000,0 L1000,100 L0,100 Z" fill="rgba(255,255,255,0.05)"/></svg>');
            background-size: cover;
        }

        .shop-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .shop-subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 0;
        }

        /* Member Badge */
        .member-badge {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 10px 15px;
            display: inline-flex;
            align-items: center;
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            max-width: 300px;
            width: 100%;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 2px solid white;
            object-fit: cover;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .user-info {
            flex-grow: 1;
            min-width: 0;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.95rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-points {
            font-size: 0.85rem;
            margin-top: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .points-icon {
            margin-right: 4px;
        }

        /* Category Scroll */
        .category-scroll {
            display: flex;
            overflow-x: auto;
            white-space: nowrap;
            padding: 15px 20px;
            margin: 0 -20px 20px;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .category-scroll::-webkit-scrollbar {
            display: none;
        }

        .category-pill {
            cursor: pointer;
            border-radius: 50px;
            padding: 8px 22px;
            background: white;
            border: 1px solid #e2e8f0;
            margin-right: 10px;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 500;
            flex-shrink: 0;
        }

        .category-pill:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .category-pill.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-color: transparent;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        /* Product Cards */
        .product-card {
            border: none;
            border-radius: 18px;
            overflow: hidden;
            background: white;
            box-shadow: var(--card-shadow);
            transition: all 0.3s;
            height: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .product-img-container {
            position: relative;
            overflow: hidden;
            height: 160px;
        }

        .product-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .product-card:hover .product-img {
            transform: scale(1.05);
        }

        .stock-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 12px;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 500;
            z-index: 10;
        }

        .out-of-stock-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5;
        }

        .product-card.out-of-stock {
            filter: grayscale(0.8);
            opacity: 0.7;
        }

        .product-info {
            padding: 15px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .product-name {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 8px;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .product-price {
            color: var(--primary-color);
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 15px;
        }

        .product-category {
            font-size: 0.75rem;
            color: #64748b;
            margin-top: auto;
            padding-top: 10px;
            border-top: 1px solid #f1f5f9;
        }

        /* Cart Bar */
        .cart-bar {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 500px;
            background: linear-gradient(135deg, #2d3436, #1a1e21);
            color: white;
            border-radius: 16px;
            padding: 16px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25);
            z-index: 1000;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
        }

        .cart-bar:hover {
            transform: translateX(-50%) translateY(-3px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
        }

        .cart-items-count {
            background: white;
            color: #2d3436;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .cart-text {
            font-weight: 600;
            font-size: 1rem;
        }

        .cart-total {
            font-weight: 700;
            font-size: 1.3rem;
        }

        /* Staff Dashboard */
        .staff-btn-container {
            position: fixed;
            bottom: 110px;
            right: 20px;
            z-index: 999;
        }

        .staff-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #2d3436, #1a1e21);
            border: none;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
            cursor: pointer;
        }

        .staff-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4);
        }

        .staff-dashboard-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-color);
            z-index: 2000;
            overflow-y: auto;
            display: none;
        }

        .dashboard-header {
            background: white;
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            position: sticky;
            top: 0;
            z-index: 10;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .stat-card {
            background: linear-gradient(135deg, #00b09b, #96c93d);
            color: white;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 20px rgba(0, 176, 155, 0.2);
        }

        /* Map Styles */
        #map {
            height: 400px;
            width: 100%;
            border-radius: 12px;
            margin-top: 10px;
            border: 1px solid #e2e8f0;
        }

        .pac-container {
            z-index: 1051 !important;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            font-family: 'Prompt', sans-serif;
        }

        /* Address Status Badge */
        .address-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            margin-top: 5px;
            font-weight: 500;
        }

        .address-status.loading {
            background: #fff3cd;
            color: #856404;
        }

        .address-status.success {
            background: #d1e7dd;
            color: #0f5132;
        }

        .address-status.error {
            background: #f8d7da;
            color: #842029;
        }

        /* Modal Styles */
        .modal-content {
            border-radius: 20px;
            border: none;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .modal-header {
            border-bottom: 1px solid #f1f5f9;
            padding: 20px 25px;
        }

        .modal-title {
            font-weight: 700;
            color: #2d3436;
        }

        .modal-body {
            padding: 25px;
        }

        /* Form Styles */
        .form-label {
            font-weight: 500;
            color: #475569;
            font-size: 0.9rem;
            margin-bottom: 6px;
        }

        .form-control, .form-select {
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 10px 15px;
            font-size: 0.95rem;
            transition: all 0.3s;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            border-radius: 10px;
            font-weight: 600;
            padding: 10px 20px;
            transition: all 0.3s;
            border: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        /* Loading States */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #64748b;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .shop-title {
                font-size: 1.5rem;
            }
            
            .product-img-container {
                height: 140px;
            }
            
            .cart-bar {
                bottom: 20px;
                padding: 14px 20px;
            }
            
            .staff-btn-container {
                bottom: 90px;
                right: 15px;
            }
            
            .staff-btn {
                width: 55px;
                height: 55px;
            }

            #map {
                height: 300px;
            }
        }

        @media (max-width: 576px) {
            .header-cover {
                padding: 30px 15px 25px;
                border-radius: 0 0 25px 25px;
            }
            
            .category-scroll {
                padding: 12px 15px;
                margin: 0 -15px 15px;
            }
            
            .product-name {
                font-size: 0.9rem;
            }
            
            .product-price {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header Section -->
    <div class="header-cover text-center animate__animated animate__fadeIn">
        <h1 class="shop-title mb-2">
            <i class="fas fa-store me-2"></i>Mini Shop
        </h1>
        <p class="shop-subtitle">‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏≠‡∏£‡πà‡∏≠‡∏¢ ‡∏™‡∏î‡πÉ‡∏´‡∏°‡πà ‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô ‡∏ï‡∏•‡∏≠‡∏î 24 ‡∏ä‡∏°.</p>
        
        <!-- User Profile -->
        <div id="profile-info" class="d-none animate__animated animate__fadeInUp">
            <div class="member-badge">
                <img id="user-img" src="" class="user-avatar" alt="Profile Picture">
                <div class="user-info">
                    <div id="user-name" class="user-name">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
                    <div id="user-points-display" class="user-points text-warning">
                        <span class="points-icon">
                            <i class="fas fa-coins"></i>
                        </span>
                        <span id="points-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Categories -->
        <div class="category-scroll" id="category-container">
            <span class="category-pill active" onclick="filterProduct('all', event)">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
        </div>

        <!-- Products Grid -->
        <div class="row g-3" id="product-list">
            <div class="col-12">
                <div class="text-center py-5">
                    <div class="loading-spinner" style="border-top-color: var(--primary-color);"></div>
                    <p class="mt-3 text-muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Staff Dashboard Button -->
    <div id="staff-entry" class="staff-btn-container d-none animate__animated animate__zoomIn">
        <button class="staff-btn" onclick="showStaffDashboard()">
            <i class="fas fa-chart-pie fa-lg"></i>
        </button>
    </div>

    <!-- Cart Bar -->
    <div class="cart-bar animate__animated animate__fadeInUp" id="cart-bar" onclick="openCartModal()" style="display: none;">
        <div class="d-flex align-items-center">
            <div class="cart-items-count" id="total-qty">0</div>
            <span class="cart-text">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span>
        </div>
        <div class="cart-total">
            <span id="total-price">0</span> <small>‡∏ø</small>
            <i class="fas fa-chevron-right ms-2 opacity-75"></i>
        </div>
    </div>

    <!-- Staff Dashboard -->
    <div id="staff-dashboard" class="staff-dashboard-overlay">
        <div class="dashboard-header">
            <div class="container">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 fw-bold">
                        <i class="fas fa-chart-line me-2 text-primary"></i>‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•
                    </h5>
                    <button class="btn btn-sm btn-light rounded-pill px-3" onclick="hideStaffDashboard()">
                        <i class="fas fa-times me-1"></i> ‡∏õ‡∏¥‡∏î
                    </button>
                </div>
            </div>
        </div>
        
        <div class="container mt-4 pb-5">
            <!-- Sales Stats -->
            <div class="stat-card">
                <h6 class="fw-bold mb-4 opacity-90">‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h6>
                <div class="row text-center">
                    <div class="col-6 border-end border-white border-opacity-25">
                        <small class="d-block opacity-90 mb-1">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°</small>
                        <span class="fw-bold fs-3" id="stat-today">0</span> ‡∏ø
                    </div>
                    <div class="col-6">
                        <small class="d-block opacity-90 mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</small>
                        <span class="fw-bold fs-3" id="stat-orders">0</span>
                    </div>
                </div>
                <div class="row mt-4 text-center">
                    <div class="col-6 border-end border-white border-opacity-25">
                        <small class="d-block opacity-90 mb-1">‡∏¢‡∏≠‡∏î‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß</small>
                        <span class="fw-bold fs-4" id="stat-realized">0</span> ‡∏ø
                    </div>
                    <div class="col-6">
                        <small class="d-block opacity-90 mb-1">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</small>
                        <span class="fw-bold fs-4" id="stat-pending">0</span> ‡∏ø
                    </div>
                </div>
            </div>

            <!-- Top Products -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-body">
                    <h6 class="fw-bold mb-3 text-muted">
                        <i class="fas fa-crown me-2 text-warning"></i>‡πÄ‡∏°‡∏ô‡∏π‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ Top 5
                    </h6>
                    <ul id="stat-top-menu" class="list-unstyled mb-0">
                        <li class="text-center text-muted py-3">
                            <div class="spinner-border spinner-border-sm text-primary me-2"></div>
                            ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Recent Orders -->
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h6 class="fw-bold m-0 text-muted">
                    <i class="fas fa-clock-rotate-left me-2"></i>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                </h6>
                <button class="btn btn-sm btn-outline-primary rounded-pill px-3" onclick="refreshDashboard()">
                    <i class="fas fa-sync-alt me-1"></i> ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                </button>
            </div>
            <div id="admin-order-list">
                <div class="text-center py-4">
                    <div class="spinner-border spinner-border-sm text-primary"></div>
                    <p class="text-muted mt-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Cart Modal -->
    <div class="modal fade" id="cartModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold">
                        <i class="fas fa-shopping-basket me-2"></i>‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Cart Items -->
                    <div id="cart-items" class="mb-4">
                        <div class="empty-state">
                            <i class="fas fa-shopping-basket"></i>
                            <p class="mb-0">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</p>
                        </div>
                    </div>

                    <!-- Order Summary -->
                    <div class="card border-0 bg-light mb-4">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="text-muted fw-bold">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</span>
                                <span class="fs-4 fw-bold text-primary">
                                    <span id="modal-total">0</span> ‡∏ø
                                </span>
                            </div>
                            <small class="text-muted d-block mt-2">
                                <i class="fas fa-info-circle me-1"></i>
                                ‡∏£‡∏ß‡∏°‡∏†‡∏≤‡∏©‡∏µ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß
                            </small>
                        </div>
                    </div>

                    <!-- Order Form -->
                    <form id="order-form">
                        <div class="mb-3">
                            <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö</label>
                            <input type="text" class="form-control" id="form-name" required
                                   placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
                        </div>

                        <div class="mb-3">
                            <label class="form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                            <input type="tel" class="form-control" id="form-tel" required
                                   placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" pattern="[0-9]{10}">
                            <small class="form-text text-muted">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ 10 ‡∏´‡∏•‡∏±‡∏Å</small>
                        </div>

                        <!-- Address with Map -->
                        <div class="mb-3">
                            <label class="form-label">
                                ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á
                                <span id="address-status"></span>
                            </label>
                            <div class="input-group mb-2">
                                <textarea class="form-control" id="form-address" rows="3" required
                                          placeholder="‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏≠‡∏á"></textarea>
                                <button class="btn btn-outline-primary" type="button" onclick="openMapModal()">
                                    <i class="fas fa-map-marker-alt text-danger"></i>
                                </button>
                            </div>
                            <small class="form-text text-success">
                                <i class="fas fa-magic me-1"></i>
                                ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà ‚Üí ‡∏•‡∏≤‡∏Å‡∏´‡∏°‡∏∏‡∏î ‚Üí ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏∞‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                            </small>
                        </div>

                        <!-- Payment Slip -->
                        <div class="mb-4">
                            <label class="form-label fw-bold text-danger">
                                <i class="fas fa-receipt me-1"></i>‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô
                            </label>
                            <input type="file" class="form-control" id="form-slip" 
                                   accept="image/*, .pdf" required>
                            <small class="form-text text-muted">
                                ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠ PDF ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏ô‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
                            </small>
                        </div>

                        <!-- Submit Button -->
                        <button type="button" id="btn-submit" class="btn btn-primary w-100 py-3 fw-bold"
                                onclick="submitOrder()">
                            <i class="fas fa-paper-plane me-2"></i>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Map Modal -->
    <div class="modal fade" id="mapModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold">
                        <i class="fas fa-map-marked-alt me-2 text-primary"></i>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Search Box -->
                    <div class="input-group mb-3 shadow-sm">
                        <span class="input-group-text bg-white border-end-0">
                            <i class="fas fa-search text-muted"></i>
                        </span>
                        <input type="text" id="map-search" class="form-control border-start-0"
                               placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà ‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô, ‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î, ‡∏´‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏û‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤...">
                        <button class="btn btn-outline-primary" type="button" onclick="useCurrentLocation()">
                            <i class="fas fa-location-crosshairs me-1"></i>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                        </button>
                    </div>

                    <!-- Current Address Display -->
                    <div id="current-address-display" class="alert alert-light border mb-3" style="display: none;">
                        <div class="d-flex align-items-start">
                            <i class="fas fa-map-pin text-danger me-2 mt-1"></i>
                            <div class="flex-grow-1">
                                <small class="text-muted d-block mb-1">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</small>
                                <div id="current-address-text" class="fw-500"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Map Container -->
                    <div id="map" class="position-relative">
                        <div class="position-absolute top-50 start-50 translate-middle text-center">
                            <div class="spinner-border text-primary"></div>
                            <p class="mt-2 text-muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà...</p>
                        </div>
                    </div>

                    <div class="alert alert-info mt-3 mb-0">
                        <div class="d-flex align-items-start">
                            <i class="fas fa-info-circle me-2 mt-1"></i>
                            <div>
                                <strong>‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:</strong>
                                <ol class="mb-0 mt-1 ps-3">
                                    <li>‡∏•‡∏≤‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏™‡∏µ‡πÅ‡∏î‡∏á üìç ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</li>
                                    <li>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</li>
                                    <li>‡∏Å‡∏î "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                    <button type="button" class="btn btn-primary" onclick="confirmLocation()">
                        <i class="fas fa-check-circle me-1"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ô‡∏µ‡πâ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Main Application Script -->
    <script>
        // ==========================================
        //  CONFIGURATION
        // ==========================================
        const CONFIG = {
            liffId: "2008933274-cQhoTxw9",
            scriptUrl: "https://script.google.com/macros/s/AKfycbzKGEIllWVMwLiI60gzOW_I7FpRnu7MGT8dsORN58q0LD0pPhOJSi5KiSZqesg-Z4i3/exec",
            // ‡πÉ‡∏ä‡πâ Google Maps API Key ‡πÅ‡∏ö‡∏ö hardcode ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö (‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á)
            mapsApiKey: "YOUR_GOOGLE_MAPS_API_KEY" // <-- ‡πÉ‡∏™‡πà API Key ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
        };

        // ==========================================
        //  GLOBAL VARIABLES
        // ==========================================
        let products = [];
        let cart = {};
        let userProfile = {};
        let selectedCoords = null;
        let currentAddress = '';
        
        // Google Maps
        let map = null;
        let marker = null;
        let geocoder = null;
        let isMapLoaded = false;
        let autocomplete = null;
        let geocodingTimeout = null; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö debounce

        // ==========================================
        //  INITIALIZATION
        // ==========================================
        window.onload = async function() {
            console.log('Starting application...');
            
            try {
                await initLiff();
                await fetchProducts();
                updateCartUI();
                
                console.log('Application initialized successfully');
            } catch (error) {
                console.error('Initialization error:', error);
                showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö');
            }
        };

        // ==========================================
        //  API FUNCTIONS
        // ==========================================
        async function fetchAPI(action, params = {}) {
            try {
                console.log(`Fetching API: ${action}`, params);
                
                const url = new URL(CONFIG.scriptUrl);
                url.searchParams.append('action', action);
                
                Object.keys(params).forEach(key => {
                    if (params[key] !== undefined && params[key] !== null) {
                        url.searchParams.append(key, params[key]);
                    }
                });
                
                const response = await fetch(url.toString());
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log(`API ${action} response:`, data);
                
                return data;
            } catch (error) {
                console.error(`API Error (${action}):`, error);
                return null;
            }
        }

        async function postAPI(payload) {
            try {
                console.log('Posting API:', payload);
                
                const response = await fetch(CONFIG.scriptUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('POST response:', data);
                
                return data;
            } catch (error) {
                console.error('POST API Error:', error);
                throw error;
            }
        }

        // ==========================================
        //  LIFF & USER MANAGEMENT
        // ==========================================
        async function initLiff() {
            try {
                console.log('Initializing LIFF...');
                
                await liff.init({ 
                    liffId: CONFIG.liffId 
                });
                
                if (!liff.isLoggedIn()) {
                    console.log('User not logged in, redirecting to login...');
                    liff.login();
                    return;
                }
                
                const profile = await liff.getProfile();
                userProfile = {
                    userId: profile.userId,
                    displayName: profile.displayName,
                    pictureUrl: profile.pictureUrl || 'https://via.placeholder.com/150?text=User',
                    statusMessage: profile.statusMessage || ''
                };
                
                console.log('User profile loaded:', userProfile);
                
                showUserProfile();
                await updateMemberPoints();
                await checkStaffAccess();
                
            } catch (error) {
                console.error('LIFF Initialization Error:', error);
                
                userProfile = {
                    userId: 'test_user_' + Date.now(),
                    displayName: '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö',
                    pictureUrl: 'https://via.placeholder.com/150?text=Test'
                };
                
                showUserProfile();
                showWarning('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏î‡∏™‡∏≠‡∏ö');
            }
        }

        function showUserProfile() {
            const profileInfo = document.getElementById('profile-info');
            const userImg = document.getElementById('user-img');
            const userName = document.getElementById('user-name');
            const formName = document.getElementById('form-name');
            
            if (profileInfo && userProfile.displayName) {
                userImg.src = userProfile.pictureUrl;
                userImg.alt = userProfile.displayName;
                userName.textContent = userProfile.displayName;
                
                if (formName) {
                    formName.value = userProfile.displayName;
                }
                
                profileInfo.classList.remove('d-none');
                profileInfo.classList.add('animate__fadeInUp');
            }
        }

        async function updateMemberPoints() {
            if (!userProfile.userId) return;
            
            try {
                const memberData = await fetchAPI('getMember', {
                    uid: userProfile.userId,
                    name: userProfile.displayName
                });
                
                if (memberData) {
                    const pointsText = document.getElementById('points-text');
                    if (pointsText) {
                        const rankIcon = getRankIcon(memberData.rank);
                        pointsText.innerHTML = `${rankIcon} ${memberData.rank} | <strong>${memberData.points}</strong> ‡πÅ‡∏ï‡πâ‡∏°`;
                    }
                }
            } catch (error) {
                console.error('Update member points error:', error);
            }
        }

        function getRankIcon(rank) {
            switch(rank) {
                case 'Super VIP üëë': return 'üëë';
                case 'VIP ‚≠ê': return '‚≠ê';
                case 'Regular üéØ': return 'üéØ';
                default: return 'üÜï';
            }
        }

        async function checkStaffAccess() {
            if (!userProfile.userId) return;
            
            try {
                const staffCheck = await fetchAPI('checkStaff', {
                    uid: userProfile.userId
                });
                
                if (staffCheck && staffCheck.isStaff) {
                    const staffEntry = document.getElementById('staff-entry');
                    if (staffEntry) {
                        staffEntry.classList.remove('d-none');
                    }
                }
            } catch (error) {
                console.error('Staff check error:', error);
            }
        }

        // ==========================================
        //  PRODUCT MANAGEMENT
        // ==========================================
        async function fetchProducts() {
            console.log('Fetching products...');
            
            try {
                const productList = document.getElementById('product-list');
                productList.innerHTML = `
                    <div class="col-12">
                        <div class="text-center py-5">
                            <div class="loading-spinner" style="border-top-color: var(--primary-color);"></div>
                            <p class="mt-3 text-muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£...</p>
                        </div>
                    </div>
                `;
                
                const apiUrl = CONFIG.scriptUrl + '?action=getProducts';
                const response = await fetch(apiUrl);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data && Array.isArray(data)) {
                    products = data.map(item => ({
                        name: item.name || item.Menu || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠',
                        price: parseFloat(item.price || item.Price || 0),
                        category: item.category || item.Category || '‡∏≠‡∏∑‡πà‡∏ô‡πÜ',
                        img: item.img || item.Image || 'https://via.placeholder.com/300x200?text=No+Image',
                        inStock: item.inStock === true || 
                                 item.InStock === true || 
                                 String(item.inStock).toLowerCase() === 'true' ||
                                 String(item.InStock).toLowerCase() === 'true'
                    }));
                    
                    renderCategories();
                    renderProducts(products);
                    
                } else {
                    throw new Error('Invalid data format');
                }
                
            } catch (error) {
                console.error('Fetch products error:', error);
                showWarning('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á');
                
                products = [
                    {
                        name: "‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡∏Å‡∏£‡∏∞‡πÄ‡∏û‡∏£‡∏≤",
                        price: 50,
                        category: "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏à‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß",
                        img: "https://img.wongnai.com/p/1920x0/2021/08/17/d47d0571d98b4e6eb5935ef3cfac5e1d.jpg",
                        inStock: true
                    },
                    {
                        name: "‡∏ú‡∏±‡∏î‡πÑ‡∏ó‡∏¢",
                        price: 60,
                        category: "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏à‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß",
                        img: "https://img.wongnai.com/p/1920x0/2019/01/30/1484fec4a4264e319b8809a6b98d9c18.jpg",
                        inStock: true
                    }
                ];
                
                renderCategories();
                renderProducts(products);
            }
        }

        function renderCategories() {
            const container = document.getElementById('category-container');
            if (!container) return;
            
            const allCategories = ['‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î'];
            products.forEach(product => {
                if (product.category && !allCategories.includes(product.category)) {
                    allCategories.push(product.category);
                }
            });
            
            const categoryHTML = allCategories.map(category => `
                <span class="category-pill ${category === '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' ? 'active' : ''}" 
                      onclick="filterProduct('${category}', event)">
                    ${category}
                </span>
            `).join('');
            
            container.innerHTML = categoryHTML;
        }

        function filterProduct(category, event) {
            document.querySelectorAll('.category-pill').forEach(el => {
                el.classList.remove('active');
            });
            
            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            let filteredProducts = products;
            if (category !== '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î') {
                filteredProducts = products.filter(p => p.category === category);
            }
            
            renderProducts(filteredProducts);
        }

        function renderProducts(productList) {
            const container = document.getElementById('product-list');
            if (!container) return;
            
            if (!productList || productList.length === 0) {
                container.innerHTML = `
                    <div class="col-12">
                        <div class="empty-state">
                            <i class="fas fa-utensils-slash"></i>
                            <p class="mb-2">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ô‡∏µ‡πâ</p>
                            <button class="btn btn-sm btn-outline-primary" onclick="filterProduct('‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î')">
                                ‡∏î‡∏π‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                            </button>
                        </div>
                    </div>
                `;
                return;
            }
            
            const productHTML = productList.map((product, index) => {
                const isAvailable = product.inStock !== false;
                const imageUrl = product.img || 'https://via.placeholder.com/300x200?text=No+Image';
                
                return `
                    <div class="col-6 col-md-4 col-lg-3 animate__animated animate__fadeIn" 
                         style="animation-delay: ${index * 50}ms">
                        <div class="product-card ${!isAvailable ? 'out-of-stock' : ''}">
                            <div class="product-img-container">
                                <img src="${imageUrl}" 
                                     class="product-img" 
                                     alt="${product.name}"
                                     loading="lazy"
                                     onerror="this.src='https://via.placeholder.com/300x200?text=No+Image'">
                                
                                ${!isAvailable ? `
                                    <div class="stock-badge">
                                        <i class="fas fa-times-circle me-1"></i>‡∏´‡∏°‡∏î
                                    </div>
                                    <div class="out-of-stock-overlay">
                                        <span class="badge bg-danger py-2 px-3">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î</span>
                                    </div>
                                ` : ''}
                            </div>
                            
                            <div class="product-info">
                                <div class="product-name">${product.name}</div>
                                <div class="product-price">${product.price ? product.price.toLocaleString() : '0'} ‡∏ø</div>
                                
                                <button class="btn btn-sm ${isAvailable ? 'btn-primary' : 'btn-secondary'} w-100"
                                        onclick="addToCart('${product.name.replace(/'/g, "\\'")}')"
                                        ${!isAvailable ? 'disabled' : ''}>
                                    ${isAvailable ? 
                                        '<i class="fas fa-plus me-1"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤' : 
                                        '<i class="fas fa-ban me-1"></i> ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î'}
                                </button>
                                
                                ${product.category ? `
                                    <div class="product-category">
                                        <i class="fas fa-tag me-1"></i>${product.category}
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = productHTML;
        }

        // ==========================================
        //  CART MANAGEMENT
        // ==========================================
        function addToCart(productName) {
            const product = products.find(p => p.name === productName);
            if (!product) {
                showError('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö');
                return;
            }
            
            if (!product.inStock) {
                showWarning('‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß');
                return;
            }
            
            if (cart[productName]) {
                cart[productName].qty += 1;
            } else {
                cart[productName] = {
                    product: product,
                    qty: 1
                };
            }
            
            showSuccess(`‡πÄ‡∏û‡∏¥‡πà‡∏° ${productName} ‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß`);
            updateCartUI();
        }

        function updateCartUI() {
            const cartItems = Object.values(cart);
            const totalQty = cartItems.reduce((sum, item) => sum + item.qty, 0);
            const totalPrice = cartItems.reduce((sum, item) => 
                sum + (item.product.price * item.qty), 0
            );
            
            document.getElementById('total-qty').textContent = totalQty;
            document.getElementById('total-price').textContent = totalPrice.toLocaleString();
            document.getElementById('modal-total').textContent = totalPrice.toLocaleString();
            
            const cartBar = document.getElementById('cart-bar');
            if (totalQty > 0) {
                cartBar.style.display = 'flex';
            } else {
                cartBar.style.display = 'none';
            }
            
            updateCartModalItems();
        }

        function updateCartModalItems() {
            const container = document.getElementById('cart-items');
            const cartItems = Object.values(cart);
            
            if (cartItems.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-shopping-basket"></i>
                        <p class="mb-0">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</p>
                    </div>
                `;
                return;
            }
            
            const itemsHTML = cartItems.map(item => `
                <div class="cart-item d-flex align-items-center mb-3 pb-3 border-bottom">
                    <img src="${item.product.img}" 
                         class="rounded me-3" 
                         style="width: 60px; height: 60px; object-fit: cover;"
                         alt="${item.product.name}"
                         onerror="this.src='https://via.placeholder.com/60?text=Img'">
                    
                    <div class="flex-grow-1">
                        <div class="fw-bold mb-1">${item.product.name}</div>
                        <div class="text-muted small">${item.product.price.toLocaleString()} ‡∏ø/‡∏ä‡∏¥‡πâ‡∏ô</div>
                    </div>
                    
                    <div class="d-flex align-items-center">
                        <button class="btn btn-sm btn-outline-secondary rounded-circle p-0" 
                                style="width: 30px; height: 30px;"
                                onclick="changeCartQty('${item.product.name.replace(/'/g, "\\'")}', -1)">
                            <i class="fas fa-minus"></i>
                        </button>
                        
                        <span class="mx-3 fw-bold" style="min-width: 30px; text-align: center;">
                            ${item.qty}
                        </span>
                        
                        <button class="btn btn-sm btn-outline-primary rounded-circle p-0" 
                                style="width: 30px; height: 30px;"
                                onclick="changeCartQty('${item.product.name.replace(/'/g, "\\'")}', 1)">
                            <i class="fas fa-plus"></i>
                        </button>
                        
                        <button class="btn btn-sm btn-outline-danger ms-3" 
                                onclick="removeFromCart('${item.product.name.replace(/'/g, "\\'")}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = itemsHTML;
        }

        function changeCartQty(productName, delta) {
            if (cart[productName]) {
                const newQty = cart[productName].qty + delta;
                
                if (newQty <= 0) {
                    delete cart[productName];
                } else {
                    cart[productName].qty = newQty;
                }
                
                updateCartUI();
            }
        }

        function removeFromCart(productName) {
            if (cart[productName]) {
                delete cart[productName];
                updateCartUI();
                showWarning(`‡∏•‡∏ö ${productName} ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß`);
            }
        }

        function openCartModal() {
            if (Object.keys(cart).length === 0) {
                showWarning('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }
            
            const modal = new bootstrap.Modal(document.getElementById('cartModal'));
            modal.show();
        }

        // ==========================================
        //  ORDER SUBMISSION
        // ==========================================
        async function submitOrder() {
            const name = document.getElementById('form-name').value.trim();
            const phone = document.getElementById('form-tel').value.trim();
            const address = document.getElementById('form-address').value.trim();
            const slipFile = document.getElementById('form-slip').files[0];
            
            if (!name) {
                showError('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö');
                document.getElementById('form-name').focus();
                return;
            }
            
            if (!phone || !/^[0-9]{10}$/.test(phone)) {
                showError('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå 10 ‡∏´‡∏•‡∏±‡∏Å');
                document.getElementById('form-tel').focus();
                return;
            }
            
            if (!address) {
                showError('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á');
                document.getElementById('form-address').focus();
                return;
            }
            
            if (!slipFile) {
                showError('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ô‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô');
                document.getElementById('form-slip').focus();
                return;
            }
            
            if (Object.keys(cart).length === 0) {
                showError('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠');
                return;
            }
            
            const cartItems = Object.values(cart);
            const totalPrice = cartItems.reduce((sum, item) => 
                sum + (item.product.price * item.qty), 0
            );
            
            const orderSummary = cartItems.map(item => 
                `${item.product.name} x${item.qty}`
            ).join('\n');
            
            const { isConfirmed } = await Swal.fire({
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠',
                html: `
                    <div class="text-start">
                        <p><strong>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö:</strong> ${name}</p>
                        <p><strong>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</strong> ${phone}</p>
                        <p><strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> ${address}</p>
                        <hr>
                        <p><strong>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠:</strong></p>
                        <pre style="background: #f8f9fa; padding: 10px; border-radius: 5px; font-size: 0.9rem;">${orderSummary}</pre>
                        <hr>
                        <p class="fs-5"><strong>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°:</strong> ${totalPrice.toLocaleString()} ‡∏ö‡∏≤‡∏ó</p>
                    </div>
                `,
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠',
                cancelButtonText: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33'
            });
            
            if (!isConfirmed) return;
            
            const submitBtn = document.getElementById('btn-submit');
            const originalBtnText = submitBtn.innerHTML;
            
            submitBtn.disabled = true;
            submitBtn.innerHTML = `
                <span class="spinner-border spinner-border-sm me-2"></span>
                ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå...
            `;
            
            try {
                const maxSize = 10 * 1024 * 1024;
                if (slipFile.size > maxSize) {
                    throw new Error('‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 10MB)');
                }
                
                const slipBase64 = await fileToBase64(slipFile);
                
                const orderData = {
                    action: 'submitOrder',
                    uid: userProfile.userId || 'guest',
                    name: name,
                    phone: phone,
                    address: address,
                    items: cartItems.map(item => 
                        `${item.product.name} (x${item.qty})`
                    ).join(', '),
                    total: totalPrice,
                    image: slipBase64.split(',')[1],
                    mimeType: slipFile.type || 'image/jpeg',
                    coords: selectedCoords ? `${selectedCoords.lat},${selectedCoords.lng}` : ''
                };
                
                const result = await postAPI(orderData);
                
                if (result && result.result === 'Success') {
                    await Swal.fire({
                        title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        text: `‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå: ${result.orderId}`,
                        icon: 'success',
                        confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                        timer: 5000
                    });
                    
                    cart = {};
                    selectedCoords = null;
                    currentAddress = '';
                    document.getElementById('order-form').reset();
                    document.getElementById('form-name').value = userProfile.displayName || '';
                    document.getElementById('address-status').innerHTML = '';
                    
                    const cartModal = bootstrap.Modal.getInstance(document.getElementById('cartModal'));
                    if (cartModal) cartModal.hide();
                    
                    updateCartUI();
                    updateMemberPoints();
                    
                } else {
                    throw new Error(result?.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ');
                }
                
            } catch (error) {
                console.error('Order submission error:', error);
                showError(`‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${error.message}`);
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalBtnText;
            }
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        // ==========================================
        //  GOOGLE MAPS - ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡∏°‡πà
        // ==========================================
        async function openMapModal() {
            const modal = new bootstrap.Modal(document.getElementById('mapModal'));
            modal.show();
            
            if (!isMapLoaded) {
                await loadGoogleMaps();
            }
        }

        async function loadGoogleMaps() {
            try {
                // ‡∏•‡∏≠‡∏á‡∏î‡∏∂‡∏á API Key ‡∏à‡∏≤‡∏Å backend ‡∏Å‡πà‡∏≠‡∏ô
                let apiKey = CONFIG.mapsApiKey;
                
                try {
                    const keyData = await fetchAPI('getMapsKey');
                    if (keyData && keyData.key) {
                        apiKey = keyData.key;
                    }
                } catch (e) {
                    console.log('Using hardcoded API key');
                }
                
                if (!apiKey || apiKey === 'YOUR_GOOGLE_MAPS_API_KEY') {
                    throw new Error('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Maps API Key ‡πÉ‡∏ô CONFIG.mapsApiKey');
                }
                
                // ‡πÇ‡∏´‡∏•‡∏î Google Maps Script
                await new Promise((resolve, reject) => {
                    if (window.google && window.google.maps) {
                        resolve();
                        return;
                    }
                    
                    const script = document.createElement('script');
                    script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&libraries=places&language=th`;
                    script.async = true;
                    script.defer = true;
                    script.onload = resolve;
                    script.onerror = () => reject(new Error('Failed to load Google Maps'));
                    document.head.appendChild(script);
                });
                
                // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
                initializeMap();
                isMapLoaded = true;
                
            } catch (error) {
                console.error('Load maps error:', error);
                document.getElementById('map').innerHTML = `
                    <div class="alert alert-danger m-3">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        ${error.message}
                    </div>
                `;
            }
        }

        function initializeMap() {
            console.log('Initializing Google Map...');
            
            // ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø)
            const defaultLocation = { lat: 13.7563, lng: 100.5018 };
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
            map = new google.maps.Map(document.getElementById('map'), {
                center: defaultLocation,
                zoom: 15,
                mapTypeControl: true,
                streetViewControl: false,
                fullscreenControl: true,
                zoomControl: true,
                gestureHandling: 'greedy'
            });
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á Geocoder
            geocoder = new google.maps.Geocoder();
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á Marker
            marker = new google.maps.Marker({
                position: defaultLocation,
                map: map,
                draggable: true,
                title: '‡∏•‡∏≤‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á',
                animation: google.maps.Animation.DROP,
                icon: {
                    url: 'http://maps.google.com/mapfiles/ms/icons/red-dot.png',
                    scaledSize: new google.maps.Size(50, 50)
                }
            });
            
            // Event: ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏∏‡∏î‡∏´‡∏¢‡∏∏‡∏î‡∏•‡∏≤‡∏Å
            marker.addListener('dragend', function() {
                console.log('Marker dragend triggered');
                const position = marker.getPosition();
                updateCoordsFromPosition(position);
                performReverseGeocoding(position);
            });
            
            // Event: ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
            map.addListener('click', function(event) {
                console.log('Map clicked');
                marker.setPosition(event.latLng);
                updateCoordsFromPosition(event.latLng);
                performReverseGeocoding(event.latLng);
            });
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Autocomplete ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
            const searchInput = document.getElementById('map-search');
            autocomplete = new google.maps.places.Autocomplete(searchInput, {
                fields: ['geometry', 'formatted_address', 'name'],
                componentRestrictions: { country: 'th' }
            });
            
            autocomplete.addListener('place_changed', function() {
                const place = autocomplete.getPlace();
                
                if (!place.geometry) {
                    showWarning('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ');
                    return;
                }
                
                const location = place.geometry.location;
                map.setCenter(location);
                map.setZoom(17);
                marker.setPosition(location);
                
                updateCoordsFromPosition(location);
                updateAddressDisplay(place.formatted_address || place.name);
            });
            
            // ‡∏•‡∏≠‡∏á‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
            setTimeout(() => {
                useCurrentLocation();
            }, 1000);
            
            console.log('Map initialized successfully');
        }

        function performReverseGeocoding(position) {
            if (!geocoder) {
                console.error('Geocoder not initialized');
                return;
            }
            
            console.log('Starting reverse geocoding for:', position.lat(), position.lng());
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Loading
            updateAddressStatus('loading', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà...');
            
            // ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å timeout ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ (debounce)
            if (geocodingTimeout) {
                clearTimeout(geocodingTimeout);
            }
            
            // ‡∏ï‡∏±‡πâ‡∏á timeout ‡πÉ‡∏´‡∏°‡πà
            geocodingTimeout = setTimeout(() => {
                geocoder.geocode({ 
                    location: {
                        lat: position.lat(),
                        lng: position.lng()
                    },
                    language: 'th'
                }, function(results, status) {
                    console.log('Geocoding status:', status);
                    console.log('Geocoding results:', results);
                    
                    if (status === 'OK' && results && results[0]) {
                        const address = results[0].formatted_address;
                        console.log('Found address:', address);
                        
                        updateAddressDisplay(address);
                        updateAddressStatus('success', '‚úì ‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                        
                        // ‡πÅ‡∏™‡∏î‡∏á Toast ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                        showSuccess('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß');
                        
                    } else {
                        console.error('Geocoding failed:', status);
                        updateAddressStatus('error', '‚ö† ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏≠‡∏á');
                        showWarning('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏∞‡∏ö‡∏∏‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏≤‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ');
                    }
                });
            }, 800); // ‡∏£‡∏≠ 800ms ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏´‡∏¢‡∏∏‡∏î‡∏•‡∏≤‡∏Å
        }

        function updateCoordsFromPosition(position) {
            selectedCoords = {
                lat: position.lat(),
                lng: position.lng()
            };
            console.log('Updated coords:', selectedCoords);
        }

        function updateAddressDisplay(address) {
            currentAddress = address;
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
            document.getElementById('form-address').value = address;
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
            const displayDiv = document.getElementById('current-address-display');
            const textDiv = document.getElementById('current-address-text');
            
            if (displayDiv && textDiv) {
                textDiv.textContent = address;
                displayDiv.style.display = 'block';
            }
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
            document.getElementById('map-search').value = address;
            
            console.log('Address updated:', address);
        }

        function updateAddressStatus(type, message) {
            const statusEl = document.getElementById('address-status');
            if (!statusEl) return;
            
            let className = 'address-status ';
            switch(type) {
                case 'loading':
                    className += 'loading';
                    break;
                case 'success':
                    className += 'success';
                    break;
                case 'error':
                    className += 'error';
                    break;
            }
            
            statusEl.className = className;
            statusEl.textContent = message;
        }

        function useCurrentLocation() {
            if (!navigator.geolocation) {
                showWarning('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á');
                return;
            }
            
            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á...',
                text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    Swal.close();
                    
                    if (!map || !marker) {
                        showWarning('‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°');
                        return;
                    }
                    
                    const userLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    
                    console.log('User location:', userLocation);
                    
                    map.setCenter(userLocation);
                    map.setZoom(16);
                    marker.setPosition(userLocation);
                    
                    updateCoordsFromPosition(marker.getPosition());
                    performReverseGeocoding(marker.getPosition());
                    
                    showSuccess('‡∏û‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß');
                },
                (error) => {
                    Swal.close();
                    console.error('Geolocation error:', error);
                    
                    let errorMessage = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ';
                    
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage = '‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ';
                            break;
                        case error.TIMEOUT:
                            errorMessage = '‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á';
                            break;
                    }
                    
                    showWarning(errorMessage);
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        }

        function confirmLocation() {
            if (!currentAddress) {
                showWarning('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }
            
            // ‡∏õ‡∏¥‡∏î Modal
            const mapModal = bootstrap.Modal.getInstance(document.getElementById('mapModal'));
            if (mapModal) {
                mapModal.hide();
            }
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
            showSuccess('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
            updateAddressStatus('success', '‚úì ‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß');
        }

        // Event Listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Modal
        document.getElementById('mapModal').addEventListener('shown.bs.modal', function() {
            if (map) {
                setTimeout(() => {
                    google.maps.event.trigger(map, 'resize');
                    if (marker) {
                        map.setCenter(marker.getPosition());
                    }
                }, 300);
            }
        });

        // ==========================================
        //  STAFF DASHBOARD (‡∏¢‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà)
        // ==========================================
        function showStaffDashboard() {
            document.getElementById('staff-dashboard').style.display = 'block';
            refreshDashboard();
        }

        function hideStaffDashboard() {
            document.getElementById('staff-dashboard').style.display = 'none';
        }

        async function refreshDashboard() {
            try {
                const stats = await fetchAPI('getOwnerStats');
                
                if (stats) {
                    document.getElementById('stat-today').textContent = stats.todaySales?.toLocaleString() || '0';
                    document.getElementById('stat-orders').textContent = stats.totalOrders?.toLocaleString() || '0';
                    document.getElementById('stat-realized').textContent = stats.realizedRevenue?.toLocaleString() || '0';
                    document.getElementById('stat-pending').textContent = stats.pendingRevenue?.toLocaleString() || '0';
                    
                    const topMenuList = document.getElementById('stat-top-menu');
                    if (stats.topMenus && stats.topMenus.length > 0) {
                        topMenuList.innerHTML = stats.topMenus.map((item, index) => `
                            <li class="d-flex justify-content-between align-items-center py-2 border-bottom">
                                <div class="d-flex align-items-center">
                                    <span class="badge ${getRankBadgeColor(index)} me-2">${index + 1}</span>
                                    <span>${item.name}</span>
                                </div>
                                <span class="badge bg-success">${item.count} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span>
                            </li>
                        `).join('');
                    } else {
                        topMenuList.innerHTML = `<li class="text-center text-muted py-3">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</li>`;
                    }
                }
                
                const orders = await fetchAPI('getAdminOrders');
                const orderList = document.getElementById('admin-order-list');
                
                if (orders && orders.length > 0) {
                    orderList.innerHTML = orders.slice(0, 10).map(order => `
                        <div class="card border-0 shadow-sm mb-3">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <div>
                                        <span class="badge ${getStatusBadgeColor(order.Status)} mb-2">
                                            ${order.Status || '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£'}
                                        </span>
                                        <h6 class="fw-bold mb-1">${order.Name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠'}</h6>
                                        <small class="text-muted">
                                            <i class="far fa-clock me-1"></i>
                                            ${order.Timestamp || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ß‡∏•‡∏≤'}
                                        </small>
                                    </div>
                                    <div class="text-end">
                                        <div class="fw-bold text-primary fs-5">
                                            ${parseFloat(order.Total || 0).toLocaleString()} ‡∏ø
                                        </div>
                                        <small class="text-muted">${order['Order ID'] || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏´‡∏±‡∏™'}</small>
                                    </div>
                                </div>
                                
                                <p class="mb-2 small">${order.Items || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£'}</p>
                                
                                <div class="d-flex gap-2 mt-3">
                                    ${order.SlipURL && order.SlipURL !== 'Error Uploading' ? `
                                        <button class="btn btn-sm btn-outline-primary flex-grow-1"
                                                onclick="viewSlip('${order.SlipURL}')">
                                            <i class="fas fa-receipt me-1"></i>‡∏î‡∏π‡∏™‡∏•‡∏¥‡∏õ
                                        </button>
                                    ` : ''}
                                    
                                    <button class="btn btn-sm btn-dark flex-grow-1"
                                            onclick="updateOrderStatus('${order['Order ID']}')">
                                        <i class="fas fa-edit me-1"></i>‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    orderList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-clipboard-list"></i>
                            <p class="mb-0">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('Refresh dashboard error:', error);
                showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÑ‡∏î‡πâ');
            }
        }

        function getRankBadgeColor(index) {
            const colors = ['bg-danger', 'bg-warning', 'bg-info', 'bg-primary', 'bg-secondary'];
            return colors[index] || 'bg-secondary';
        }

        function getStatusBadgeColor(status) {
            switch(status) {
                case '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô': return 'bg-success';
                case '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏≠‡∏≤‡∏´‡∏≤‡∏£': return 'bg-warning';
                case '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á': return 'bg-info';
                case '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å': return 'bg-danger';
                default: return 'bg-secondary';
            }
        }

        async function updateOrderStatus(orderId) {
            const { value: status } = await Swal.fire({
                title: '‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå',
                input: 'select',
                inputOptions: {
                    '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£': '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£',
                    '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏≠‡∏≤‡∏´‡∏≤‡∏£': '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏≠‡∏≤‡∏´‡∏≤‡∏£',
                    '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á': '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á',
                    '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô': '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô',
                    '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å': '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
                },
                inputPlaceholder: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞',
                showCancelButton: true,
                confirmButtonText: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
            });
            
            if (status) {
                try {
                    await postAPI({
                        action: 'updateStatus',
                        orderId: orderId,
                        newStatus: status
                    });
                    
                    showSuccess('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                    refreshDashboard();
                    
                } catch (error) {
                    showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏î‡πâ');
                }
            }
        }

        function viewSlip(url) {
            if (!url || url.includes('Error')) {
                showWarning('‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏•‡∏¥‡∏õ');
                return;
            }
            
            Swal.fire({
                title: '‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô',
                html: `<img src="${url}" style="max-width: 100%; border-radius: 10px;" alt="Slip">`,
                showCloseButton: true,
                showConfirmButton: false,
                width: '90%'
            });
        }

        // ==========================================
        //  UTILITY FUNCTIONS
        // ==========================================
        function showSuccess(message) {
            Swal.fire({
                title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                text: message,
                icon: 'success',
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true
            });
        }

        function showError(message) {
            Swal.fire({
                title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                text: message,
                icon: 'error',
                confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
            });
        }

        function showWarning(message) {
            Swal.fire({
                title: '‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô',
                text: message,
                icon: 'warning',
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000
            });
        }

        // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Form Submit
        document.getElementById('order-form').addEventListener('submit', function(e) {
            e.preventDefault();
        });

        console.log('Mini Shop Application loaded');
    </script>
</body>
</html>
