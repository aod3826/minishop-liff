<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡πâ‡∏≥‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞ - ‡∏™‡∏±‡πà‡∏á‡∏á‡πà‡∏≤‡∏¢ ‡πÑ‡∏î‡πâ‡πÄ‡∏£‡πá‡∏ß</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { font-family: 'Prompt', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: #f5f7fa; padding-bottom: 100px; }
        
        /* Header ‡∏™‡∏ß‡∏¢‡πÜ */
        .app-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 0 0 30px 30px;
            box-shadow: 0 4px 20px rgba(102,126,234,0.3);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        /* ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ */
        .status-bar {
            position: fixed; top: 0; left: 0; right: 0;
            padding: 5px; text-align: center;
            font-size: 12px; z-index: 9999; display: none;
        }
        .status-bar.online { background: #10b981; color: white; display: block; }
        .status-bar.offline { background: #ef4444; color: white; display: block; }
        .status-bar.demo { background: #f59e0b; color: white; display: block; }
        
        /* ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà */
        .category-chips {
            display: flex; gap: 10px; overflow-x: auto;
            padding: 15px; margin: 0 -10px;
            scrollbar-width: none;
        }
        .category-chips::-webkit-scrollbar { display: none; }
        
        .chip {
            background: white; border: 2px solid #e2e8f0;
            border-radius: 50px; padding: 8px 20px;
            white-space: nowrap; cursor: pointer;
            transition: all 0.3s; font-weight: 500;
        }
        .chip.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white; border-color: transparent;
            transform: scale(1.05);
        }
        
        /* ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px; padding: 0 15px;
        }
        
        .product-card {
            background: white; border-radius: 20px;
            overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }
        .product-card:active { transform: scale(0.98); }
        
        .product-img {
            width: 100%; height: 150px;
            object-fit: cover; background: #f0f0f0;
        }
        .product-info { padding: 15px; }
        .product-name { font-weight: 600; font-size: 15px; margin-bottom: 5px; }
        .product-price { 
            color: #667eea; font-weight: 700; font-size: 18px;
            margin-bottom: 10px;
        }
        
        .btn-add {
            width: 100%; border: none;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white; padding: 10px;
            border-radius: 12px; font-weight: 600;
            display: flex; align-items: center;
            justify-content: center; gap: 5px;
        }
        .btn-add:disabled {
            background: #cbd5e1; cursor: not-allowed;
        }
        
        /* ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏•‡∏≠‡∏¢ */
        .floating-cart {
            position: fixed; bottom: 20px; left: 50%;
            transform: translateX(-50%);
            background: #1e293b; color: white;
            padding: 15px 30px; border-radius: 50px;
            display: none; align-items: center; gap: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 1000; cursor: pointer;
        }
        .cart-badge {
            background: #ef4444; color: white;
            width: 24px; height: 24px;
            border-radius: 50%; display: flex;
            align-items: center; justify-content: center;
            font-size: 12px; font-weight: bold;
        }
        
        /* Modal ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ */
        .order-modal .modal-content {
            border-radius: 30px 30px 0 0;
            border: none; min-height: 90vh;
        }
        
        .queue-number {
            font-size: 80px; font-weight: 800;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center; margin: 20px 0;
        }
        
        /* ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ */
        .hidden { display: none !important; }
        
        /* Loading */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
</head>
<body>
    <!-- ‡πÅ‡∏à‡πâ‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ -->
    <div id="status-bar" class="status-bar">
        <i class="fas fa-circle"></i> <span id="status-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</span>
    </div>

    <!-- Header -->
    <div class="app-header">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h4 class="m-0 fw-bold"><i class="fas fa-mug-hot me-2"></i>‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡πâ‡∏≥‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</h4>
                <small id="user-name">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</small>
            </div>
            <div class="text-end">
                <div id="user-points" class="small bg-white bg-opacity-25 rounded-pill px-3 py-1">
                    <i class="fas fa-star text-warning"></i> <span>0 ‡πÅ‡∏ï‡πâ‡∏°</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà -->
    <div class="category-chips" id="categories">
        <div class="chip active" onclick="filter('all', this)">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
    </div>

    <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
    <div class="product-grid" id="products">
        <!-- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ JS -->
        <div class="product-card skeleton" style="height: 250px;"></div>
        <div class="product-card skeleton" style="height: 250px;"></div>
        <div class="product-card skeleton" style="height: 250px;"></div>
        <div class="product-card skeleton" style="height: 250px;"></div>
    </div>

    <!-- ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ -->
    <div class="floating-cart" id="cart-btn" onclick="showCart()">
        <i class="fas fa-shopping-basket fa-lg"></i>
        <span id="cart-text">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</span>
        <div class="cart-badge" id="cart-count">0</div>
        <span class="fw-bold" id="cart-total">‡∏ø0</span>
    </div>

    <!-- Modal ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤/‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ -->
    <div class="modal fade order-modal" id="cartModal" tabindex="-1">
        <div class="modal-dialog modal-fullscreen-sm-down">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title fw-bold">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="cart-items" class="mb-3"></div>
                    
                    <div class="card bg-light border-0 mb-3">
                        <div class="card-body d-flex justify-content-between">
                            <span class="fw-bold">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
                            <span class="fw-bold text-primary fs-5" id="modal-total">‡∏ø0</span>
                        </div>
                    </div>

                    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">‡∏ä‡∏∑‡πà‡∏≠-‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
                        <input type="text" class="form-control form-control-lg mb-2" id="cust-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
                        <input type="tel" class="form-control form-control-lg" id="cust-phone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ (10 ‡∏´‡∏•‡∏±‡∏Å)" maxlength="10">
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</label>
                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-outline-primary flex-fill active" onclick="setPayment('cash', this)">
                                <i class="fas fa-money-bill-wave d-block mb-1"></i> ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î
                            </button>
                            <button type="button" class="btn btn-outline-primary flex-fill" onclick="setPayment('transfer', this)">
                                <i class="fas fa-qrcode d-block mb-1"></i> ‡πÇ‡∏≠‡∏ô
                            </button>
                        </div>
                    </div>

                    <button class="btn btn-primary btn-lg w-100 py-3 rounded-pill" onclick="submitOrder()">
                        <i class="fas fa-paper-plane me-2"></i>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal ‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏¥‡∏ß -->
    <div class="modal fade" id="queueModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content text-center p-4 border-0">
                <div class="mb-3"><i class="fas fa-check-circle text-success fa-3x"></i></div>
                <h4 class="fw-bold">‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h4>
                <p class="text-muted">‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏¥‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                <div class="queue-number" id="queue-num">A001</div>
                <p class="text-muted small">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏à‡∏≤‡∏Å‡∏ó‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...</p>
                <button class="btn btn-primary rounded-pill px-5" onclick="location.reload()">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</button>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // ==========================================
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ (‡πÅ‡∏Å‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ)
        // ==========================================
        const CONFIG = {
            // üîß ‡πÉ‡∏™‡πà URL ‡∏à‡∏≤‡∏Å Apps Script ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ (‡∏à‡∏ö‡∏î‡πâ‡∏ß‡∏¢ /exec)
            API_URL: "https://script.google.com/macros/s/AKfycbzKGEIllWVMwLiI60gzOW_I7FpRnu7MGT8dsORN58q0LD0pPhOJSi5KiSZqesg-Z4i3/exec",
            
            // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ URL ‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô true
            DEMO_MODE: false
        };

        // ==========================================
        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏´‡∏•‡∏±‡∏Å
        // ==========================================
        let products = [];
        let cart = {};
        let currentPayment = 'cash';
        let isOnline = false;

        // ==========================================
        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)
        // ==========================================
        window.onload = function() {
            document.getElementById('user-name').textContent = '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö';
            loadProducts();
        };

        // ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
        async function loadProducts() {
            showStatus('loading', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏ô‡∏π...');
            
            try {
                // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ URL ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô Demo
                if (CONFIG.DEMO_MODE || !CONFIG.API_URL.includes('exec')) {
                    throw new Error('Demo');
                }

                const response = await fetch(CONFIG.API_URL + '?action=getProducts');
                const data = await response.json();
                
                if (data.error) throw new Error(data.message);
                if (!data.data || data.data.length === 0) throw new Error('Empty');
                
                products = data.data;
                isOnline = true;
                showStatus('online', '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                
            } catch (e) {
                console.log('‡πÉ‡∏ä‡πâ‡πÇ‡∏´‡∏°‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:', e.message);
                isOnline = false;
                showStatus('demo', '‡πÇ‡∏´‡∏°‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á (‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ô‡πá‡∏ï)');
                
                // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö
                products = [
                    { id: 1, name: "‡∏ä‡∏≤‡∏ô‡∏°‡πÑ‡∏Ç‡πà‡∏°‡∏∏‡∏Å", price: 45, category: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°", img: "https://img.wongnai.com/p/400x0/2020/03/23/eea71893e97b43e68a2c6b1e0832f40c.jpg", stock: true },
                    { id: 2, name: "‡∏ä‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏°‡∏∞‡∏•‡∏¥", price: 40, category: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°", img: "https://img.wongnai.com/p/400x0/2019/05/21/0e72a68cf43d47a79424c5b2f9b20e02.jpg", stock: true },
                    { id: 3, name: "‡∏≠‡πÄ‡∏°‡∏£‡∏¥‡∏Å‡∏≤‡πÇ‡∏ô‡πà", price: 50, category: "‡∏Å‡∏≤‡πÅ‡∏ü", img: "https://img.wongnai.com/p/400x0/2019/08/20/3a8632eb3a9b4ff8816c57f8dc1a4c0a.jpg", stock: true },
                    { id: 4, name: "‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏Ç‡πà‡πÄ‡∏à‡∏µ‡∏¢‡∏ß", price: 35, category: "‡∏≠‡∏≤‡∏´‡∏≤‡∏£", img: "https://img.wongnai.com/p/400x0/2018/03/28/af4b1c48755e465990be4aa6e1d36e6c.jpg", stock: true }
                ];
            }
            
            renderCategories();
            renderProducts();
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        function showStatus(type, text) {
            const bar = document.getElementById('status-bar');
            const txt = document.getElementById('status-text');
            
            bar.className = 'status-bar ' + type;
            txt.textContent = text;
            
            if (type === 'online') {
                setTimeout(() => bar.style.display = 'none', 3000);
            }
        }

        // ==========================================
        // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
        // ==========================================
        function renderCategories() {
            const cats = [...new Set(products.map(p => p.category))];
            const container = document.getElementById('categories');
            
            cats.forEach(cat => {
                const div = document.createElement('div');
                div.className = 'chip';
                div.textContent = cat;
                div.onclick = () => filter(cat, div);
                container.appendChild(div);
            });
        }

        function renderProducts(filterCat = 'all') {
            const container = document.getElementById('products');
            const filtered = filterCat === 'all' 
                ? products 
                : products.filter(p => p.category === filterCat);
            
            container.innerHTML = filtered.map(p => `
                <div class="product-card" onclick="addToCart(${p.id})">
                    <img src="${p.img}" class="product-img" onerror="this.src='https://via.placeholder.com/300x200?text=${p.name}'">
                    <div class="product-info">
                        <div class="product-name">${p.name}</div>
                        <div class="product-price">‡∏ø${p.price}</div>
                        <button class="btn-add" ${p.stock === false ? 'disabled' : ''}>
                            ${p.stock === false ? '‡∏´‡∏°‡∏î' : '<i class="fas fa-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°'}
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function filter(cat, el) {
            document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            renderProducts(cat);
        }

        // ==========================================
        // ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
        // ==========================================
        function addToCart(id) {
            const p = products.find(x => x.id === id);
            if (!p || p.stock === false) return;
            
            if (cart[id]) {
                cart[id].qty++;
            } else {
                cart[id] = { ...p, qty: 1 };
            }
            
            updateCartUI();
            
            // Feedback ‡∏™‡∏±‡πâ‡∏ô‡πÜ
            const btn = event.target.closest('.product-card').querySelector('.btn-add');
            const original = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-check"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß';
            btn.style.background = '#10b981';
            setTimeout(() => {
                btn.innerHTML = original;
                btn.style.background = '';
            }, 800);
        }

        function updateCartUI() {
            const items = Object.values(cart);
            const count = items.reduce((sum, i) => sum + i.qty, 0);
            const total = items.reduce((sum, i) => sum + (i.price * i.qty), 0);
            
            document.getElementById('cart-count').textContent = count;
            document.getElementById('cart-total').textContent = '‡∏ø' + total;
            document.getElementById('cart-btn').style.display = count > 0 ? 'flex' : 'none';
        }

        function showCart() {
            const items = Object.values(cart);
            const total = items.reduce((sum, i) => sum + (i.price * i.qty), 0);
            
            document.getElementById('cart-items').innerHTML = items.map(i => `
                <div class="d-flex justify-content-between align-items-center mb-3 p-3 bg-white rounded-3 shadow-sm">
                    <div>
                        <div class="fw-bold">${i.name}</div>
                        <small class="text-muted">‡∏ø${i.price} x ${i.qty}</small>
                    </div>
                    <div class="d-flex align-items-center gap-2">
                        <button class="btn btn-sm btn-outline-secondary rounded-circle" onclick="changeQty(${i.id}, -1)">-</button>
                        <span class="fw-bold">${i.qty}</span>
                        <button class="btn btn-sm btn-outline-primary rounded-circle" onclick="changeQty(${i.id}, 1)">+</button>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('modal-total').textContent = '‡∏ø' + total;
            new bootstrap.Modal(document.getElementById('cartModal')).show();
        }

        function changeQty(id, delta) {
            if (!cart[id]) return;
            cart[id].qty += delta;
            if (cart[id].qty <= 0) delete cart[id];
            updateCartUI();
            showCart(); // Refresh
        }

        function setPayment(method, btn) {
            currentPayment = method;
            document.querySelectorAll('#cartModal .btn-outline-primary').forEach(b => {
                b.classList.remove('active');
            });
            btn.classList.add('active');
        }

        // ==========================================
        // ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
        // ==========================================
        async function submitOrder() {
            const name = document.getElementById('cust-name').value.trim();
            const phone = document.getElementById('cust-phone').value.trim();
            
            if (!name || !phone || phone.length < 9) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö');
                return;
            }
            
            const items = Object.values(cart).map(i => `${i.name} x${i.qty}`).join(', ');
            const total = Object.values(cart).reduce((sum, i) => sum + (i.price * i.qty), 0);
            
            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Demo Mode ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏¥‡∏ß‡∏õ‡∏•‡∏≠‡∏°
            if (!isOnline) {
                document.getElementById('queue-num').textContent = 'A' + Math.floor(Math.random() * 900 + 100);
                bootstrap.Modal.getInstance(document.getElementById('cartModal')).hide();
                new bootstrap.Modal(document.getElementById('queueModal')).show();
                return;
            }
            
            try {
                const res = await fetch(CONFIG.API_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'submitOrder',
                        name: name,
                        phone: phone,
                        items: items,
                        total: total,
                        paymentMethod: currentPayment,
                        uid: 'guest'
                    })
                });
                
                const data = await res.json();
                
                if (data.success) {
                    document.getElementById('queue-num').textContent = data.queue;
                    bootstrap.Modal.getInstance(document.getElementById('cartModal')).hide();
                    new bootstrap.Modal(document.getElementById('queueModal')).show();
                } else {
                    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + data.message);
                }
            } catch (e) {
                alert('‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
            }
        }
    </script>
</body>
</html>
